### **数独 (Sudoku) 游戏开发计划 (v2)**

#### **1. 项目目标**

创建一个功能完整的、基于 Web 的数独游戏。游戏界面和功能将参考用户提供的截图，核心玩法包括生成谜题、玩家解题、输入验证、提示、计时、**以及保存和加载游戏进度**。

#### **2. 技术选型**

*   **前端框架**: 无 (使用原生 HTML, CSS, 和 JavaScript)
*   **核心逻辑**: JavaScript
*   **样式**: CSS
*   **状态存储**: 浏览器 `localStorage`
*   **项目结构**:
    ```
    sudoku-game/
    ├── index.html
    ├── css/
    │   └── style.css
    └── js/
        ├── app.js
        ├── sudoku.js
    └── PLAN.md
    └── README.md
    ```

#### **3. 功能模块分解**

1.  **UI 界面构建 (HTML & CSS)**
2.  **数独棋盘生成 (JavaScript)**
3.  **核心算法 (JavaScript - `js/sudoku.js`)**
4.  **用户交互逻辑 (JavaScript - `js/app.js`)**
5.  **游戏功能实现 (JavaScript - `js/app.js`)**
6.  **(新增) 游戏状态管理 (保存/加载 - `js/app.js`)**
    *   **保存游戏状态**: 创建一个 `saveGame()` 函数。该函数会在每次玩家有效操作后（如填入或清除数字）被自动调用。它会将以下数据打包成一个 JSON 对象并存入 `localStorage`:
        *   当前棋盘的所有数字 (包括原始谜题和玩家填写的数字)。
        *   原始生成的谜题 (用于区分固定数字和玩家输入的数字)。
        *   已用时间。
        *   当前难度。
    *   **加载游戏状态**: 创建一个 `loadGame()` 函数。当页面加载时，程序会首先检查 `localStorage` 中是否存在已保存的进度。
        *   如果存在，则弹窗询问用户是否“继续上一次的游戏？”。
        *   如果用户同意，则调用 `loadGame()` 函数，从 `localStorage` 读取数据，并恢复棋盘状态、计时器和难度设置。
        *   如果用户拒绝或不存在存档，则正常开始新游戏。
    *   **清除存档**: 当用户点击“新游戏”并确认后，或者游戏胜利后，清除 `localStorage` 中的存档。

#### **4. 开发流程图 (更新版)**

```mermaid
graph TD
    A[开始] --> B{检查 localStorage 中是否有存档?};
    B -- 是 --> C{弹窗询问: "是否继续上次的游戏?"};
    C -- 是 --> D[加载游戏: 恢复棋盘, 计时器和难度];
    C -- 否 --> E[清除旧存档];
    B -- 否 --> F[选择难度];
    E --> F;
    F --> G[点击 "新游戏"];
    G --> H[游戏开始: 生成棋盘 & 启动计时器];
    D --> I(游戏进行中);
    H --> I;


    subgraph "I[游戏进行中]"
        direction LR
        J{选择一个空格} --> K[点击数字键盘];
        K --> L[填充数字];
        L --> M[自动保存进度到 localStorage];
        M --> J
    end

    I --> N[完成或放弃游戏];