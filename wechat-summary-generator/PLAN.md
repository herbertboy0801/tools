### **项目规划 V2：微信聊天精华摘要工具 (AI 增强版)**

#### **1. 项目目标 (已更新)**

创建一个名为 `wechat-summary-generator` 的智能前端工具。它不仅能基于消息密度识别讨论“热点”，还能**利用大型语言模型 (LLM) 对聊天内容进行深度的自动摘要和情感分析**，最终生成一份包含多维度洞察的、可交互的 HTML 报告。

#### **2. 核心功能分解 (已扩展)**

1.  **聊天记录上传与解析**
2.  **“讨论热点”分析引擎**
3.  **[新增] AI 智能分析模块**:
    *   **核心能力**:
        *   **对话摘要**: 对用户选定的“热点时段”或整个聊天记录，调用 AI 模型生成一段高质量的、概括性的摘要。例如：“本次讨论的核心是关于周末团建的地点选择，主要在 A 方案和 B 方案之间摇摆，小明倾向于 A，而小红提出了对 B 方案的预算顾虑。”
        *   **情感分析**: 分析指定时间段内整体的对话情绪是积极、消极还是中性。
        *   **关键词提取**: 自动抽取出对话中的核心关键词。
    *   **交互实现**: 在报告中，每个“热点”旁边增加一个“AI 分析”按钮。用户点击后，工具会将该段聊天记录发送给 AI 模型进行处理，并将返回的结果（摘要、情感等）显示在报告中。

4.  **交互式 HTML 报告生成** (功能增强)
    *   报告现在不仅包含热点列表，还为每个热点预留了展示 AI 分析结果的区域。

#### **3. 技术架构设计 (重大更新)**

为了集成 AI 功能，我们无法再维持纯前端架构。因为前端直接调用 AI 服务 API 会暴露密钥，非常不安全。因此，我们需要引入一个轻量的本地后端（或代理服务器）来安全地处理 API 请求。

*   **前端**：原生 JavaScript、HTML5、CSS3。
*   **后端 (代理)**：**Node.js + Express** 是一个绝佳选择。它非常轻量，仅用于：
    1.  接收前端发送的聊天记录片段。
    2.  安全地附加您的 AI API 密钥。
    3.  将请求转发给第三方 AI 服务（如 OpenAI, Google AI, 或国内的 Kimi, 文心一言等）。
    4.  将 AI 返回的结果再传回给前端。
*   **AI 服务**: 需要用户提供所选 AI 服务的 API Key。

**[重要] 隐私与成本考量**:
*   **隐私**: 使用此功能意味着您的部分聊天记录将被发送到您选择的第三方 AI 服务提供商进行处理。我们会在界面上明确提示这一点。
*   **成本**: 调用 AI 模型通常会产生费用，具体取决于您使用的平台和调用量。

**处理流程图 (AI 版):**

```mermaid
graph TD
    A[用户在 index.html 上传 .txt 文件] --> B{1. JS 读取和解析};
    B --> C[2. 分析引擎找出热点];
    C --> D[3. 报告生成器渲染基本报告];

    subgraph AI 分析流程
        E[用户点击 'AI分析' 按钮] --> F{4. 前端将热点文本<br>发送给本地后端};
        F --> G[5. 本地后端 (Node.js)<br>附加 API Key<br>调用外部 AI API];
        G --> H[6. 外部 AI 模型<br>处理文本并返回结果];
        H --> I[7. 本地后端将结果<br>传回给前端];
    end

    I --> J[8. 前端将 AI 摘要<br>更新到报告页面上];
    D --> E;
```

#### **4. 项目文件结构 (已更新)**

```
wechat-summary-generator/
├── index.html
├── README.md
├── PLAN.md
│
├── css/
│   └── style.css
│
├── js/
│   ├── app.js
│   ├── parser.js
│   ├── analyzer.js
│   └── renderer.js
│
├── server/                  # 新增: 后端代理服务器
│   ├── server.js            # Express 服务器逻辑
│   └── package.json         # Node.js 项目依赖
│
└── examples/
    └── sample-chat.txt
```

#### **5. 开发路线图 (已调整)**

1.  **第一阶段：基础功能实现**
    *   完成无 AI 的版本，实现文件解析、热点分析和基本报告生成。确保核心流程跑通。
2.  **第二阶段：集成 AI 分析**
    *   搭建 `server/` 目录下的 Node.js 代理服务器。
    *   在前端界面增加“AI 分析”按钮和用于输入 API Key 的配置项。
    *   实现前后端通信，完成一次完整的“点击 -> 发送 -> AI 处理 -> 返回 -> 显示”的流程。
3.  **第三阶段：优化与完善**
    *   美化 AI 结果的展示样式。
    *   增加错误处理机制（如 API Key 无效、网络请求失败等）。
    *   提供“导出包含 AI 分析的报告”功能。